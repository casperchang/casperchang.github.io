<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>A simple map</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	
	<link rel="stylesheet" type="text/css" href="./d3/css/styles.css" />
	<script type="text/javascript" src="./d3/d3.v3.js"></script>
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.css' rel='stylesheet' />
	
	<style>
  	body { margin:0; padding:0; }
  	#map { position:absolute; top:0; bottom:0; width:100%; }
	</style>	
</head>
<body>
	<div id='map'></div>
	
<script>
	L.mapbox.accessToken = 'pk.eyJ1IjoiY2FzcGVydml6IiwiYSI6IjFyNHlFYkUifQ.61-Ph449J2Zqn0KNynDpUw'; // my public token
	var map = L.mapbox.map('map', 'examples.map-i86nkdio')
    			.setView([28.19, 113.03], 5);
    			
    map.tileLayer.setOpacity(0.8);
	
    
    var myLayer = L.geoJson().addTo(map);
    
	d3.json("geojson-flights2012.json", function(json) {
		
		var max = d3.max(json.features, function(d) { return d.properties.passengers; });
		var min = d3.min(json.features, function(d) { return d.properties.passengers; });
		var scale = d3.scale.sqrt()
						.domain([min, max])
						.range([5,15]);
		//console.log(max);
		
/* 		L.geoJson(json, {
		    pointToLayer: function(feature, latlng) {
		        return L.circleMarker(latlng, {
		            radius: scale(feature.properties.passengers)
		        })
		    }
		}).addTo(map);
 */		
		myLayer.addData(json, {
		    pointToLayer: function(feature, latlng) {
		        return L.circleMarker(latlng, {
		            radius: scale(feature.properties.passengers)
		        })
		    }
		});
	});
	
	var latlngs = []
	latlngs.push(L.latLng(25.0, 121.0));
	latlngs.push(L.latLng(26.0, 122.0));	
	var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
	
</script>


</body>
</html>